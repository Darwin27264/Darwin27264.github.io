/* RESET */
*,*::before,*::after{box-sizing:border-box}
html{scroll-behavior:smooth}
body,h1,h2,h3,h4,p,ul,ol,figure{margin:0}
ul,ol{padding:0}
img,picture{max-width:100%;display:block}
a{color:inherit;text-decoration:none}
button{font:inherit}

/* TOKENS */
:root{
  --bg:#0F1115; --text:#ECEEF3; --muted:#A7ADBA;
  --card:#121722; --line:#232734; --accent:#6AA6FF;
  --wrap-max:min(1920px,93vw);
  --content:clamp(64ch,74ch + 8vw,102ch);
  --rail-w:190px; --rail-gap:clamp(16px,2vw,28px);
  --rail-offset:calc(var(--rail-w) + var(--rail-gap));
  --radius:18px; --shadow:0 1px 1px rgba(0,0,0,.02),0 12px 40px rgba(0,0,0,.28);
  --thin:300; --regular:400; --semi:600;
  --fab-fg:#EDEFF6;
  --theming-transition: color .38s ease, background-color .38s ease, border-color .38s ease, box-shadow .38s ease;
  font-family:"Inter Tight",ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial,"Noto Sans";
  font-weight:var(--thin);
  font-size:clamp(16px,0.9vw + 10px,21px);
  line-height:1.65;
}
@media (prefers-color-scheme: light){
  :root{--bg:#FAFAFA;--text:#111317;--muted:#5B616E;--card:#FFFFFF;--line:#E6E8EF;--accent:#2463EB;--fab-fg:#0B0D12}
}
html[data-theme="light"]{--bg:#FAFAFA;--text:#111317;--muted:#5B616E;--card:#FFFFFF;--line:#E6E8EF;--accent:#2463EB;--fab-fg:#0B0D12}
html[data-theme="dark"]{--bg:#0F1115;--text:#ECEEF3;--muted:#A7ADBA;--card:#121722;--line:#232734;--accent:#6AA6FF;--fab-fg:#EDEFF6}

/* Slightly decrease base type when rail is visible but not ultrawide */
@media (min-width:901px) and (max-width:1600px){
  :root{ font-size:clamp(15px,0.7vw + 10px,20px); }
}

/* animated theming */
html.theming *{transition:var(--theming-transition)}

/* BASE */
body{background:var(--bg);color:var(--text);-webkit-font-smoothing:antialiased;text-rendering:optimizeLegibility}

/* Layout container + extra left padding when rail is visible but not ultrawide */
.wrap{max-width:var(--wrap-max);margin-inline:auto;padding-inline:clamp(16px,3vw,44px)}
@media (min-width:901px) and (max-width:1600px){
  .wrap{padding-left:calc(clamp(16px,3vw,44px) + var(--rail-offset));}
}

.content{max-width:var(--content);margin-inline:auto}
section{padding-block:clamp(96px,14vw,220px);border-top:1px solid var(--line)}

/* HERO – tighter top space */
.hero{padding-top:calc(clamp(72px,12vw,180px) + env(safe-area-inset-top));padding-bottom:clamp(90px,13vw,220px)}
section[data-reveal]{contain: layout style}

/* TYPE */
h1,h2,h3{font-weight:var(--regular);letter-spacing:-.01em}
.sub{color:var(--muted);margin-top:.6rem;margin-bottom:clamp(18px,2.4vw,26px)}
.muted{color:var(--muted)}

/* VERTICAL NAV */
.vnav{position:fixed;left:0;top:50%;transform:translateY(-50%);z-index:60;width:190px;padding-left:clamp(10px,1vw,18px)}
.vnav-top{display:inline-block;margin:0 0 14px 0;padding:4px 0;text-transform:uppercase;letter-spacing:.12em;font-size:.78rem;color:var(--muted);position:relative}
.vnav-top::after{content:"";position:absolute;left:0;bottom:-2px;height:1px;width:22px;background:color-mix(in srgb,var(--accent) 80%,transparent);transform:scaleX(0);transform-origin:left;transition:transform .25s ease}
.vnav-top:hover{color:var(--text)} .vnav-top:hover::after{transform:scaleX(1)}
.vnav-items{display:grid;gap:18px}
.vnav-item{text-transform:uppercase;letter-spacing:.12em;font-size:.8rem;color:var(--muted);padding:4px 0;position:relative}
.vnav-item::after{content:"";position:absolute;left:0;bottom:-2px;height:1px;width:28px;background:color-mix(in srgb,var(--accent) 80%,transparent);transform:scaleX(0);transform-origin:left;transition:transform .25s ease}
.vnav-item:hover{color:var(--text)} .vnav-item:hover::after{transform:scaleX(1)}
.vnav-item.active{color:var(--text)} .vnav-item.active::after{transform:scaleX(1)}
@media (max-width:900px){
  .vnav{inset:0 0 auto 0;transform:none;width:auto;background:color-mix(in srgb,var(--bg) 85%,transparent);backdrop-filter:saturate(140%) blur(8px);border-bottom:1px solid var(--line);padding:10px 12px}
  .vnav-top{display:none}
  .vnav-items{display:flex;gap:18px;justify-content:center}
}

/* BRAND TARGET */
.brand-target{
  position:fixed; top:10px; left:12px; z-index:55;
  font-size:clamp(1rem, 0.9rem + 0.5vw, 1.35rem);
  letter-spacing:.12em; text-transform:uppercase; color:var(--muted);
  opacity:0; pointer-events:none; user-select:none;
  display:inline-flex; flex-direction:column; line-height:1; gap:2px;
}
.brand-target .brand-line{display:block;white-space:nowrap}
@media (max-width:900px){.brand-target{display:none}}

/* THEME FAB */
.theme-fab{
  position:fixed;left:16px;bottom:16px;z-index:65;width:44px;height:44px;border-radius:12px;
  background:linear-gradient(to bottom,rgba(255,255,255,.06),rgba(255,255,255,.02)),color-mix(in srgb,var(--bg) 70%,transparent);
  border:1px solid color-mix(in srgb,var(--line) 80%,transparent);
  box-shadow:0 20px 40px rgba(0,0,0,.35),inset 0 1px 0 rgba(255,255,255,.06);
  color:var(--fab-fg);display:grid;place-items:center;cursor:pointer;
  transition:transform .16s ease,border-color .16s ease,box-shadow .16s ease,background .16s ease,color .16s ease
}
.theme-fab:hover{transform:translateY(-1px);border-color:color-mix(in srgb,var(--accent) 35%,var(--line));box-shadow:0 26px 60px rgba(0,0,0,.4),inset 0 1px 0 rgba(255,255,255,.08)}
.sunmoon{stroke:currentColor;fill:none;stroke-width:1.5;vector-effect:non-scaling-stroke}
.sunmoon .sun circle{fill:currentColor} .sunmoon .sun .rays line{stroke:currentColor;stroke-linecap:round}
.sunmoon .moon path{fill:currentColor}
html[data-theme="dark"] .sunmoon .sun{opacity:1;transform:scale(1);transition:transform .24s ease,opacity .24s ease}
html[data-theme="dark"] .sunmoon .moon{opacity:0;transform:scale(.8);transition:transform .24s ease,opacity .24s ease}
html:not([data-theme="dark"]) .sunmoon .sun{opacity:0;transform:scale(.8);transition:transform .24s ease,opacity .24s ease}
html:not([data-theme="dark"]) .sunmoon .moon{opacity:1;transform:scale(1);transition:transform .24s ease,opacity .24s ease}

/* GEO — LOCATION CARD (top-right) */
.geo-fab{
  position:fixed; right:16px; top:16px; z-index:65;
  display:flex; flex-direction:column; gap:.15rem; align-items:flex-end; text-align:right;
  color:var(--fab-fg);
  opacity:.75; transition:opacity .2s ease, filter .2s ease;
}
html.scroll-active .geo-fab{ opacity:.4; }
.geo-fab:hover, .geo-fab:focus-within{ opacity:1; }
.loc-card{background:none;border:0;box-shadow:none}
.loc-kicker{font-size:.64rem;letter-spacing:.18em;text-transform:uppercase;color:var(--muted)}
.loc-city{font-size:.82rem;letter-spacing:.04em}
.loc-coords{display:block;font-size:.78rem;color:var(--muted)}
.loc-time{display:block;margin-top:.15rem;font-size:.76rem;opacity:.9}

/* PROGRESS */
.progress{position:fixed;left:0;top:0;height:1px;width:0%;z-index:70;background:linear-gradient(90deg,var(--accent),transparent)}

/* HERO */
.hero-layout{display:grid;gap:clamp(22px,2.6vw,30px);align-items:start}
@media (min-width:1100px){.hero-layout{grid-template-columns:1fr minmax(160px,220px)}}
.letters{display:grid;gap:.2em}
.letters .line{display:block}
.letters .char{display:inline-block;opacity:0;transform:translateY(16px)}
.letters .char.in{opacity:1;transform:none;transition:transform .6s cubic-bezier(.2,.8,.2,1),opacity .6s ease}
.hero-name{transform-origin:top left;will-change:transform}
.hero-name h1{font-weight:300;line-height:1;letter-spacing:-.02em;font-size:clamp(2.1rem,6.4vw,5.6rem)}
@media (min-width:901px) and (max-width:1600px){
  .hero-name h1{font-size:clamp(2rem,5.4vw,5.2rem)}
}
.hero-name .hero-kicker{margin-top:.7rem;margin-bottom:1.05rem;color:var(--muted);text-transform:uppercase;letter-spacing:.14em;font-size:.76rem}
.hero-photo{aspect-ratio:1/1;border-radius:14px;overflow:hidden;border:1px solid var(--line);background:color-mix(in srgb,var(--card) 70%,transparent);box-shadow:var(--shadow);max-width:clamp(120px,15vw,200px);justify-self:end;align-self:start;transition:transform .25s ease,box-shadow .25s ease,filter .25s ease}
.hero-photo:hover{transform:translateY(-2px);box-shadow:0 18px 50px rgba(0,0,0,.35);filter:saturate(1.02)}
.lead{font-size:clamp(1.02rem,1.15vw,1.35rem);color:var(--muted);max-width:74ch;margin-top:clamp(18px,2.2vw,30px)}

.morphable.pinned{position:fixed;z-index:56;top:var(--brand-top,10px);left:var(--brand-left,12px);transform:scale(var(--brand-scale,1)) translateZ(0)}
@media (max-width:900px){.morphable.pinned{position:static;transform:none}}

/* CTAs */
.cta-row{display:flex;gap:14px;flex-wrap:wrap;margin-top:14px}
.btn{display:inline-flex;align-items:center;gap:10px;padding:12px 16px;border-radius:14px;border:1px solid var(--line);background:var(--card);box-shadow:var(--shadow);transition:transform .18s ease,box-shadow .18s ease,border-color .18s ease,filter .18s ease}
.btn:hover{transform:translateY(-2px);box-shadow:0 2px 2px rgba(0,0,0,.02),0 14px 32px rgba(0,0,0,.25);border-color:color-mix(in srgb,var(--accent) 30%,var(--line));filter:brightness(1.02)}
.btn.primary{background:var(--accent);color:#fff;border-color:transparent}
.btn.subtle{background:color-mix(in srgb,var(--card) 94%,transparent)}

/* SECTION HEAD */
.section-head{display:flex;align-items:end;justify-content:space-between;margin-bottom:clamp(18px,2.6vw,28px)}
.s-kicker{color:var(--muted);text-transform:uppercase;letter-spacing:.18em;font-size:.72rem}

/* TIMELINE */
.timeline{list-style:none;margin-left:14px;position:relative}
.timeline::before{content:"";position:absolute;left:0;top:0;bottom:0;width:2px;background:linear-gradient(var(--line),color-mix(in srgb,var(--accent) 18%,var(--line)))}
.t-item{position:relative;padding-left:28px;margin-bottom:clamp(24px,3vw,36px)}
.t-dot{position:absolute;left:-6px;top:8px;width:12px;height:12px;border-radius:999px;background:radial-gradient(circle at 30% 30%,#fff 0%,#fff 6%,var(--accent) 8%,var(--accent) 60%,transparent 70%);box-shadow:0 0 0 3px color-mix(in srgb,var(--accent) 25%,transparent);transition:transform .2s ease,box-shadow .2s ease}
.t-item:hover .t-dot{transform:scale(1.06);box-shadow:0 0 0 4px color-mix(in srgb,var(--accent) 35%,transparent)}
.t-card{background:var(--card);border:1px solid var(--line);border-radius:var(--radius);padding:clamp(18px,2.2vw,26px);box-shadow:var(--shadow);opacity:0;transform:translateY(12px);transition:border-color .2s ease,box-shadow .2s ease,transform .2s ease}
.t-card.in{opacity:1;transform:none;transition:opacity .6s ease,transform .6s ease}
.t-card:hover{border-color:color-mix(in srgb,var(--accent) 22%,var(--line));box-shadow:0 12px 40px rgba(0,0,0,.28)}
.t-head{display:flex;flex-direction:column;gap:.25rem;margin-bottom:.4rem}
.t-head h3{font-weight:400;font-size:clamp(1.05rem,1.2vw,1.25rem)}
.where{color:var(--muted)} .when{color:var(--muted);font-size:.96rem}
.t-card ul{list-style:disc;padding-left:1.1rem;display:grid;gap:6px;margin-top:8px}
.t-tech{display:flex;gap:10px;margin-top:10px}
.i{width:24px;height:24px;display:block;fill:none;stroke:currentColor;color:var(--muted);stroke-width:1.6}
.i-badge{width:28px;height:28px;fill:none;stroke:currentColor;color:var(--muted);stroke-width:1.2;shape-rendering:geometricPrecision}
.i-badge text{fill:currentColor;font:600 10px/1 "Inter Tight",system-ui;letter-spacing:.04em}

/* PROJECTS */
.cards{display:grid;gap:clamp(16px,2.4vw,24px)}
@media(min-width:960px){.cards{grid-template-columns:repeat(12,1fr)} .card{grid-column:span 6}}
.card{position:relative;isolation:isolate;border:1px solid var(--line);border-radius:var(--radius);background:var(--card);box-shadow:var(--shadow);cursor:pointer;overflow:hidden;transition:transform .18s ease,border-color .18s ease,box-shadow .18s ease,filter .2s ease}
.card::after{content:"";position:absolute;inset:0;background:linear-gradient(120deg,transparent 0%,rgba(255,255,255,.04) 30%,transparent 60%);transform:translateX(-60%);transition:transform .6s ease;pointer-events:none}
.card:hover{transform:translateY(-2px);border-color:color-mix(in srgb,var(--accent) 25%,var(--line));box-shadow:0 2px 2px rgba(0,0,0,.02),0 12px 28px rgba(0,0,0,.25);filter:brightness(1.02)}
.card:hover::after{transform:translateX(0%)}
.card-strip{height:clamp(84px,9vw,140px);background:radial-gradient(600px 180px at 20% 50%,color-mix(in srgb,var(--accent) 18%,transparent),transparent 60%),linear-gradient(0deg,color-mix(in srgb,var(--card) 90%,transparent),transparent 40%);border-bottom:1px solid var(--line)}
.card-body{padding:clamp(18px,2.2vw,24px)} .card-body h3{font-weight:400;font-size:clamp(1.1rem,1.4vw,1.5rem);margin-bottom:.4rem} .card-body p{color:var(--muted)}

/* MODAL */
.modal{position:fixed;inset:0;display:grid;place-items:center;background:rgba(0,0,0,.35);backdrop-filter:blur(4px);opacity:0;pointer-events:none;z-index:80;transition:opacity .22s ease}
.modal.open{opacity:1;pointer-events:auto}
.modal-panel{width:min(800px,92vw);border:1px solid var(--line);border-radius:16px;background:var(--card);box-shadow:var(--shadow);transform:translateY(8px) scale(.98);opacity:.98;transition:transform .22s ease;padding:clamp(20px,2.4vw,28px);position:relative}
.modal.open .modal-panel{transform:none;opacity:1}
.modal-close{position:absolute;top:10px;right:14px;width:36px;height:36px;border-radius:10px;border:1px solid var(--line);background:var(--card);display:grid;place-items:center;cursor:pointer;color:var(--text)}
.modal-tech{display:flex;gap:10px;margin:.6rem 0}

/* ABOUT */
.about-shells{display:grid;gap:clamp(16px,2.8vw,28px)}
@media (min-width:840px){
  .about-shells{grid-template-columns:repeat(12,1fr)}
  .about-shells .shell{grid-column:span 6}
  .about-shells .shell.wide{grid-column:1 / -1}
}
.about-shells.playful .shell{
  position:relative;
  background:linear-gradient(180deg,color-mix(in srgb,var(--card) 96%,transparent),transparent 30%),var(--card);
  border:1px solid var(--line);
  border-radius:16px;
  padding:clamp(18px,2.2vw,26px);
  box-shadow:var(--shadow);
  transition:transform .22s ease, box-shadow .22s ease, border-color .22s ease, filter .22s ease;
  overflow:hidden;
}
.about-shells.playful .shell::after{
  content:""; position:absolute; inset:-40% -80%;
  background:linear-gradient(120deg, transparent 40%, rgba(255,255,255,.08) 50%, transparent 60%);
  transform:translateX(-20%); transition:transform .8s ease; pointer-events:none;
}
.about-shells.playful .shell:hover{
  transform:translateY(-4px);
  box-shadow:0 16px 48px rgba(0,0,0,.32);
  border-color:color-mix(in srgb,var(--accent) 28%,var(--line));
}
.about-shells.playful .shell:hover::after{ transform:translateX(8%); }
.shell-head{display:flex;gap:10px;align-items:center;margin-bottom:.6rem}
.shell-head .dot{position:relative; width:8px;height:8px;border-radius:999px;background:var(--accent); box-shadow:0 0 0 3px color-mix(in srgb,var(--accent) 25%,transparent);}
.shell-head .dot::after{content:""; position:absolute; inset:-6px; border-radius:999px; background:color-mix(in srgb,var(--accent) 45%,transparent); animation:pulse 2.2s ease-out infinite; opacity:.55;}
@keyframes pulse{0%{transform:scale(.6); opacity:.55}60%{transform:scale(1.25); opacity:0}100%{transform:scale(1.45); opacity:0}}
.bullets{list-style:disc;padding-left:1.1rem;display:grid;gap:6px}

/* Education prettified */
.edu{display:grid;grid-template-columns: 130px 1fr;gap:.35rem .9rem}
.edu dt{color:var(--muted);font-size:.95rem}
.edu dd{margin:0}
@media (max-width:560px){
  .edu{grid-template-columns:1fr}
  .edu dt{font-weight:600}
  .edu dd{margin-bottom:.2rem}
}

/* Chips */
.chips.floaty{display:flex;flex-wrap:wrap;gap:8px}
.chip{border:1px solid var(--line);padding:.45rem .7rem;border-radius:999px;background:color-mix(in srgb,var(--card) 85%,transparent);transition:transform .18s ease, border-color .18s ease, filter .18s ease;}
.chips.floaty .chip{animation:drift 6s ease-in-out infinite; animation-delay:calc(var(--i,0)*.18s)}
.chips.floaty .chip:hover{transform:translateY(-2px);border-color:color-mix(in srgb,var(--accent) 30%,var(--line));filter:brightness(1.02)}
@keyframes drift{0%,100%{transform:translateY(0)}50%{transform:translateY(-3px)}}

/* STACK */
.stack-grid{display:grid;gap:clamp(16px,2.4vw,22px)}
@media (min-width:960px){.stack-grid{grid-template-columns:repeat(12,1fr)} .stack-col{grid-column:span 6}}
.stack-head{font-weight:400;margin-bottom:.5rem}
.badges{display:flex;flex-wrap:wrap;gap:8px}
.badge{
  --border: color-mix(in srgb,var(--line) 100%, transparent);
  display:inline-flex;align-items:center;gap:.4rem;
  padding:.48rem .72rem;border-radius:999px;
  background:color-mix(in srgb,var(--card) 92%,transparent);
  border:1px solid var(--border);
  box-shadow:0 1px 1px rgba(0,0,0,.02);
  opacity:0; transform:translateY(6px) scale(.98);
  transition:opacity .35s ease, transform .35s cubic-bezier(.2,.8,.2,1), border-color .2s ease, filter .2s ease;
}
.badge.in{opacity:1; transform:none}
.badge:hover{border-color:color-mix(in srgb,var(--accent) 35%, var(--line)); filter:brightness(1.03)}

/* CONTACT */
.contact-frame{position:relative}
.contact-grid2{display:grid;gap:clamp(24px,4vw,56px);grid-template-columns:1.1fr .9fr;align-items:start}
@media (max-width:980px){.contact-grid2{grid-template-columns:1fr}}
.c-title{font-weight:300;font-size:clamp(2.2rem,6vw,5rem);letter-spacing:-.02em}
.bubble-row{display:flex;gap:12px;flex-wrap:wrap;margin-top:clamp(14px,1.6vw,18px)}
.bubble-btn{display:inline-flex;align-items:center;gap:.6rem;padding:.9rem 1.2rem;border-radius:999px;background:var(--card);border:1px solid var(--line);box-shadow:var(--shadow);transition:transform .16s ease,box-shadow .16s ease,border-color .16s ease,filter .16s ease}
.bubble-btn:hover{transform:translateY(-2px);border-color:color-mix(in srgb,var(--accent) 35%,var(--line));box-shadow:0 10px 28px rgba(0,0,0,.28);filter:brightness(1.02)}
.bubble-btn .bullet{font-size:1.3rem;line-height:1;color:var(--text)}
.c-right{display:grid;gap:clamp(18px,2vw,24px)}
.col{display:grid;gap:.35rem}
.col-head{font-size:.82rem;text-transform:uppercase;letter-spacing:.18em;color:var(--muted);margin-bottom:.4rem}
.c-link{display:inline-flex;align-items:center;gap:.6rem;padding:.1rem .2rem;border-radius:10px;color:var(--text);position:relative}
.c-link::after{content:"";position:absolute;left:0;bottom:-2px;height:1px;width:100%;background:color-mix(in srgb,var(--accent) 80%,transparent);transform:scaleX(0);transform-origin:left;transition:transform .25s ease}
.c-link:hover::after{transform:scaleX(1)}
.ci{width:20px;height:20px;stroke:currentColor;fill:none;stroke-width:1.6;color:var(--muted);stroke-linecap:round;stroke-linejoin:round}
.ci.gh{fill:currentColor;stroke:none}

/* REVEALS */
.reveal{opacity:0;transform:translateY(12px)}
.reveal.is-in{opacity:1;transform:none;transition:opacity .55s ease,transform .55s ease}

/* AMBIENT BACKDROP */
#ambient{position:fixed;inset:0;z-index:-2;background:
  radial-gradient(1200px 1200px at 80% 10%,color-mix(in srgb,var(--accent) 14%,transparent),transparent 60%),
  radial-gradient(1000px 1000px at 10% 80%,color-mix(in srgb,var(--accent) 10%,transparent),transparent 60%),
  linear-gradient(180deg,color-mix(in srgb,var(--bg) 92%,#000 8%),var(--bg));pointer-events:none}

/* FOOTER – sticky, centered */
.smooth{min-height:100dvh;display:flex;flex-direction:column}
footer{margin-top:auto}
footer .wrap.content{display:flex;justify-content:center}
footer p{width:100%;text-align:center}

/* SMOOTH SCROLL WRAPPER */
.has-smooth #smooth{position:fixed; inset:0; will-change:transform}

/* REDUCED MOTION */
@media (prefers-reduced-motion: reduce){
  .reveal,.letters .char{opacity:1;transform:none}
  .reveal.is-in{transition:none}
  .card:hover,.theme-fab:hover,.hero-photo:hover{transform:none;box-shadow:var(--shadow)}
  .about-shells.playful .shell:hover{transform:none}
  .chips.floaty .chip{animation:none}
}

/* ==========================
   Chat overlay + FAB styles
   ========================== */
.chat-fab{
  position:fixed; right:16px; bottom:16px; z-index:75;
  display:inline-flex; align-items:center; gap:.6rem;
  padding:.7rem 1rem; border-radius:999px; border:1px solid var(--line);
  background:color-mix(in srgb,var(--card) 94%, transparent);
  box-shadow:var(--shadow); cursor:pointer;
  transition:transform .16s ease, box-shadow .16s ease, border-color .16s ease, filter .16s ease;
  color:var(--text);
}
.chat-fab:hover{ transform:translateY(-2px); border-color:color-mix(in srgb,var(--accent) 35%, var(--line)); filter:brightness(1.02) }
.chat-fab .brain{ width:18px; height:18px; fill:currentColor; color:var(--text) }
.gpu-pill{font-size:.72rem;color:var(--muted);border:1px solid var(--line);padding:.18rem .48rem;border-radius:999px;background:color-mix(in srgb,var(--card) 92%,transparent)}

/* Overlay */
.chat-overlay{
  position:fixed; inset:0; z-index:120;
  display:grid; place-items:center;
  background:rgba(0,0,0,.25);
  backdrop-filter:saturate(140%) blur(8px);
  opacity:0; pointer-events:none; transition:opacity .22s ease;
}
.chat-overlay.open{opacity:1; pointer-events:auto}

/* Panel */
.chat-panel{
  width:min(1000px,95vw);
  height:min(86dvh, 900px);
  display:grid;
  /* CHANGED: make middle track resilient */
  grid-template-rows:auto auto minmax(0, 1fr) auto;
  background:var(--card);
  border:1px solid var(--line);
  border-radius:24px;
  box-shadow:0 28px 80px rgba(0,0,0,.45);
  overflow:hidden;
}
@media (max-width:720px){
  .chat-panel{width:96vw; height:92dvh; border-radius:20px}
}
/* Optional helper when JS toggles the class */
.chat-panel.status-hidden{ grid-template-rows: auto 0 minmax(0,1fr) auto; }

/* Head */
.chat-head{display:flex; align-items:center; justify-content:space-between; gap:8px; padding:14px 16px; border-bottom:1px solid var(--line); background:color-mix(in srgb,var(--card) 96%, transparent)}
.chat-title{display:flex; align-items:center; gap:.6rem}
.chat-title .brain{width:18px;height:18px;fill:currentColor;color:var(--text)}
.chat-title h3{font-weight:400;letter-spacing:.01em}
.chat-close{width:36px;height:36px;border-radius:10px;border:1px solid var(--line);background:var(--card);display:grid;place-items:center;cursor:pointer;color:var(--text)}
.chat-close:hover{filter:brightness(1.05)}
.gpu-pill strong{font-weight:600}

/* Status / progress */
.chat-status{display:flex;flex-direction:column;gap:.4rem;padding:10px 16px;border-bottom:1px solid var(--line);background:color-mix(in srgb,var(--card) 98%, transparent)}
/* CHANGED: collapse instead of removing from layout */
.chat-status.hidden{ display:block; height:0; padding:0; margin:0; border:0; overflow:hidden; }

.status-text{font-size:.86rem;color:var(--muted)}
.progressline{position:relative;height:10px;background:color-mix(in srgb,var(--card) 92%, transparent);border:1px solid var(--line);border-radius:999px;overflow:hidden}
.progressline .bar{height:100%;background:linear-gradient(90deg,var(--accent),transparent)}
.progressline .label{position:absolute;right:8px;top:50%;transform:translateY(-50%);font-size:.72rem;color:#fff;text-shadow:0 1px 2px rgba(0,0,0,.4)}

/* Log */
.chat-log{
  padding:12px 16px; overflow:auto; line-height:1.6;
  display:flex; flex-direction:column; gap:12px;
  text-align:left;
  /* CHANGED: allow track to shrink properly */
  min-height:0;
}

/* Bubbles — clean rounded boxes with one flatter corner */
.msg{
  position:relative;
  display:flex; flex-direction:column; gap:4px;
  padding:10px 13px;
  max-width:min(720px, 85%);
  border:1px solid var(--line);
  background:color-mix(in srgb,var(--card) 97%, transparent);
  text-align:left;
}
.msg .role{font-size:.72rem;letter-spacing:.08em;text-transform:uppercase;color:var(--muted)}
.msg .content{white-space:pre-wrap; text-align:left}

/* Assistant: flatter bottom-left corner */
.msg.assistant{
  align-self:flex-start;
  border-radius:16px 16px 16px 8px; /* TL TR BR BL */
}

/* User: accent bubble, flatter bottom-right corner */
.msg.user{
  align-self:flex-end;
  color:#ffffff;
  background:linear-gradient(180deg, color-mix(in srgb,var(--accent) 85%, transparent), color-mix(in srgb,var(--accent) 65%, transparent));
  border-color:transparent;
  border-radius:16px 16px 8px 16px; /* TL TR BR BL */
}
html[data-theme="light"] .msg.user{color:#fff}
.msg.user .role{color:rgba(255,255,255,.85)}

/* Form — stable single-line height aligned with Send */
.chat-form{
  display:grid;grid-template-columns:1fr auto;gap:10px;
  padding:12px 16px;border-top:1px solid var(--line);
  background:color-mix(in srgb,var(--card) 98%, transparent)
}
.chat-form textarea{
  resize:none;border:1px solid var(--line);border-radius:12px;
  padding:.7rem .8rem;background:color-mix(in srgb,var(--card) 92%, transparent);
  color:var(--text);
  height:44px; min-height:44px; max-height:44px; /* keep steady size */
  line-height:1.3;
  /* CHANGED: hide vertical scrollbar while preserving height */
  overflow-y:hidden;
  scrollbar-width:none; /* Firefox */
}
.chat-form textarea::-webkit-scrollbar{ width:0; height:0 } /* WebKit/Chromium */
.chat-form textarea:disabled{opacity:.6;cursor:not-allowed}
.chat-form .btn.primary{padding:0 16px;height:44px;align-self:end}

/* Focus ring inside overlay */
.chat-panel :focus-visible{outline:2px solid color-mix(in srgb,var(--accent) 65%, transparent); outline-offset:2px}
